<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no" />
<title>Flappy Bird - Bindz</title>
<style>
  :root{
    --bg:#70c5ce;
    --menu-w:360px;
    --ring-radius:18px;          /* b√°n k√≠nh khung rainbow */
    --ring-pad:4px;              /* ƒë·ªô d√†y vi·ªÅn rainbow */
    --ring-speed:3.2s;           /* t·ªëc ƒë·ªô quay vi·ªÅn */
  }
  html,body{height:100%;margin:0;padding:0;background:var(--bg);font-family:Inter,Arial,sans-serif;overflow:hidden;}
  canvas{display:block;width:100vw;height:100vh;background:linear-gradient(#70c5ce,#5fb3c1);touch-action:manipulation;}

  /* HUD */
  #hudScore{
    position: fixed; left: 16px; bottom: 18px; z-index: 1000;
    color: #fff; font-weight:700; font-size:18px;
    background: rgba(0,0,0,0.25); padding:8px 12px; border-radius:10px; backdrop-filter: blur(4px);
    user-select:none;
  }

  /* Toggle (meme cat) */
  #toggleBtn{
    position: fixed; left: 18px; top: 18px; width:64px; height:64px;
    border-radius:50%; overflow:hidden; border:3px solid #fff;
    box-shadow:0 8px 22px rgba(0,0,0,0.35); z-index:1005;
    touch-action:none; cursor: grab; background:#fff; display:block; user-select:none;
  }
  #toggleBtn img{width:100%;height:100%;object-fit:cover;display:block;pointer-events:none;}

  /* Menu wrapper (·∫©n khi ƒë√≥ng) */
  .menu-wrap{
    position: fixed; right: 24px; top: 24px; width: min(var(--menu-w), 92vw); z-index:1006; display:none;
  }
  .menu-frame{
    position: relative; border-radius: var(--ring-radius); padding: var(--ring-pad); background: transparent;
  }
  /* Rainbow ch·∫°y QUANH VI·ªÄN menu (mask ƒë·ªÉ ch·ªâ c√≤n vi·ªÅn) */
  .menu-frame::before{
    content:""; position:absolute; inset:0; border-radius: calc(var(--ring-radius) + 0px);
    padding: var(--ring-pad);
    background: conic-gradient(#ff004c,#ff7a00,#ffd300,#2be7a1,#00c2ff,#7a5cff,#ff004c);
    -webkit-mask:
      linear-gradient(#000 0 0) content-box,
      linear-gradient(#000 0 0);
    -webkit-mask-composite: xor;
            mask-composite: exclude;
    filter: saturate(1.1) blur(0.0px);
    pointer-events:none;
    animation: spin var(--ring-speed) linear infinite;
  }
  @keyframes spin{ from{transform: rotate(0deg);} to{transform: rotate(360deg);} }

  /* Th√¢n menu */
  #hackMenu{
    border-radius: calc(var(--ring-radius) - 4px);
    background: linear-gradient(180deg, rgba(12,12,12,0.96), rgba(22,22,22,0.96));
    color:#fff; padding:16px; box-shadow: 0 10px 36px rgba(0,0,0,0.55);
    pointer-events:auto;
  }
  #hackMenu h2{margin:0 0 8px 0; font-size:20px; text-align:center; color:#ffdd57; font-family:"Comic Sans MS","Segoe UI",Arial;}
  .byline{ text-align:center; font-size:12px; opacity:0.9; margin-bottom:12px; }
  .menu-row{ display:flex; gap:10px; margin-bottom:12px; }
  .btn{
    flex:1; padding:10px; border-radius:10px; border:0; cursor:pointer; user-select:none;
    font-weight:800; font-size:14px; color:#111;
    background:linear-gradient(180deg,#fff6ea,#ffdba5);
    box-shadow: 0 6px 12px rgba(0,0,0,0.25); transition: transform .08s ease, box-shadow .08s ease;
  }
  .btn:active{ transform: translateY(1px); }
  .btn.active{ outline:2px solid rgba(255,255,255,0.14); box-shadow: 0 0 0 2px rgba(255,221,87,0.25) inset; }
  .btn-close{ width:100%; padding:10px; border-radius:10px; border:0; cursor:pointer; background:#101010; color:#fff; font-weight:900; }
  .note{ font-size:13px; text-align:center; opacity:0.9; margin-top:8px; }

  /* Game Over overlay (click ƒë·ªÉ reset) */
  #gameOverOverlay{
    position: fixed; inset:0; display:none; z-index:1004; background: rgba(0,0,0,0.55);
    color:#fff; font-weight:800; display:flex; align-items:center; justify-content:center; flex-direction:column;
    text-align:center; padding:20px; gap:10px; user-select:none;
  }
  #gameOverOverlay .title{ font-size: clamp(22px, 6vw, 48px); }
  #gameOverOverlay .hint{ font-size: clamp(14px, 3.5vw, 22px); opacity:0.95; }

  @media (max-width:420px){
    #toggleBtn{ left:12px; top:12px; width:56px; height:56px; }
  }
</style>
</head>
<body>

<canvas id="gameCanvas"></canvas>

<div id="hudScore">Score: 0</div>

<!-- draggable meme -->
<div id="toggleBtn" title="M·ªü Bindz Hack Menu">
  <img id="memeImg" src="https://i.imgur.com/0y8Ftya.png" alt="m√®o c∆∞·ªùi">
</div>

<!-- menu (·∫©n l√∫c ƒë·∫ßu) -->
<div class="menu-wrap" id="menuWrap" aria-hidden="true">
  <div class="menu-frame">
    <div id="hackMenu" role="dialog" aria-modal="false">
      <h2>üê¶ Bindz Hack Menu</h2>
      <div class="byline">Bindz ‚Ä¢ Debug / Tweak</div>

      <div class="menu-row">
        <button class="btn" id="speed1" data-speed="1">Bay x1</button>
        <button class="btn" id="speed2" data-speed="2">Bay x2</button>
        <button class="btn" id="speed3" data-speed="3">Bay x3</button>
      </div>

      <button id="closeMenu" class="btn-close">ƒê√≥ng Menu</button>
      <div class="note">Space / Ch·∫°m ƒë·ªÉ nh·∫£y ‚Ä¢ Ch·∫øt th√¨ d·ª´ng ‚Ä¢ Nh·∫•n ƒë·ªÉ ch∆°i l·∫°i</div>
    </div>
  </div>
</div>

<div id="gameOverOverlay">
  <div class="title">Game Over</div>
  <div class="hint">Nh·∫•n Space ho·∫∑c ch·∫°m ƒë·ªÉ ch∆°i l·∫°i</div>
</div>

<script>
/* =========================
   Canvas setup
   ========================= */
const canvas = document.getElementById('gameCanvas');
const ctx = canvas.getContext('2d');
function fitCanvas(){
  canvas.width = window.innerWidth;
  canvas.height = window.innerHeight;
  bird.r = Math.round(Math.min(canvas.width, canvas.height) * 0.035);
  bird.x = Math.round(canvas.width * 0.18);
}
window.addEventListener('resize', fitCanvas, {passive:true});

/* =========================
   Game state
   ========================= */
let score = 0;
let baseSpeed = 3;        // t·ªëc ƒë·ªô ·ªëng c∆° b·∫£n
let speedMultiplier = 1;  // hack 1..3
let gravity = 0.6;
let jumpPower = -10;

let bird = { x: 160, y: 0, r: 24, vy: 0 };
let pipes = [];
let spawnInterval = 110;  // frame
let frame = 0;
let gameOver = false;

fitCanvas();
resetGame(true);

/* =========================
   Core functions
   ========================= */
function spawnPipe(){
  const gapH = Math.round(Math.max(120, canvas.height * 0.22));
  const topH = Math.round(Math.random() * (canvas.height - gapH - 160) + 60);
  pipes.push({
    x: canvas.width + 40,
    w: Math.round(Math.min(90, canvas.width * 0.08)),
    top: topH,
    bottom: topH + gapH,
    passed: false
  });
}

function resetGame(first=false){
  pipes = [];
  frame = 0;
  score = 0;
  hud.textContent = 'Score: 0';
  bird.y = canvas.height / 2;
  bird.vy = 0;
  gameOver = false;
  overlay.style.display = 'none';
  if (!first) spawnPipe(); // c√≥ ·ªëng s·ªõm khi ch∆°i l·∫°i
}

function update(){
  if (gameOver) return; // d·ª´ng th·∫ø gi·ªõi khi ch·∫øt

  // bird physics
  bird.vy += gravity;
  bird.y += bird.vy;

  // ch·∫°m s√†n -> ch·∫øt
  if (bird.y + bird.r > canvas.height) {
    bird.y = canvas.height - bird.r;
    handleDeath();
  }
  // tr·∫ßn
  if (bird.y - bird.r < 0) {
    bird.y = bird.r;
    bird.vy = 0;
  }

  // spawn ·ªëng
  if (frame % spawnInterval === 0) spawnPipe();

  const curSpeed = baseSpeed * speedMultiplier;

  // pipes
  for (let i = pipes.length - 1; i >= 0; i--) {
    let p = pipes[i];
    p.x -= curSpeed;

    // c·ªông ƒëi·ªÉm khi v∆∞·ª£t qua
    if (!p.passed && p.x + p.w < bird.x - bird.r) {
      p.passed = true;
      score++;
      hud.textContent = 'Score: ' + score;
    }

    // va ch·∫°m (h√¨nh tr√≤n vs 2 h√¨nh ch·ªØ nh·∫≠t)
    if (rectCircle(p.x, 0, p.w, p.top, bird.x, bird.y, bird.r) ||
        rectCircle(p.x, p.bottom, p.w, canvas.height - p.bottom, bird.x, bird.y, bird.r)) {
      handleDeath();
    }

    // d·ªçn ·ªëng c≈©
    if (p.x + p.w < -50) pipes.splice(i,1);
  }

  frame++;
}

function draw(){
  ctx.clearRect(0,0,canvas.width,canvas.height);

  // n·ªÅn tr·ªùi gradient (ƒë√£ c√≥ CSS, v·∫Ω nh·∫π tr√°nh artifacts)
  let grad = ctx.createLinearGradient(0,0,0,canvas.height);
  grad.addColorStop(0,'#70c5ce'); grad.addColorStop(1,'#5fb3c1');
  ctx.fillStyle = grad;
  ctx.fillRect(0,0,canvas.width,canvas.height);

  // ·ªëng
  ctx.fillStyle = '#228B22';
  for (let p of pipes){
    ctx.fillRect(p.x, 0, p.w, p.top);
    ctx.fillRect(p.x, p.bottom, p.w, canvas.height - p.bottom);
  }

  // chim (h√¨nh tr√≤n)
  ctx.save();
  ctx.translate(bird.x, bird.y);
  ctx.beginPath();
  ctx.fillStyle = '#FFD23F';
  ctx.arc(0,0,bird.r,0,Math.PI*2);
  ctx.fill();
  // m·∫Øt
  ctx.fillStyle = '#000';
  ctx.beginPath();
  ctx.arc(bird.r*0.3, -bird.r*0.15, Math.max(2, bird.r*0.18), 0, Math.PI*2);
  ctx.fill();
  ctx.restore();
}

function loop(){
  update();
  draw();
  requestAnimationFrame(loop);
}
requestAnimationFrame(loop);

/* =========================
   Helpers
   ========================= */
function rectCircle(rx, ry, rw, rh, cx, cy, r){
  const closestX = Math.max(rx, Math.min(cx, rx+rw));
  const closestY = Math.max(ry, Math.min(cy, ry+rh));
  const dx = cx - closestX, dy = cy - closestY;
  return (dx*dx + dy*dy) <= r*r;
}

/* =========================
   Input
   ========================= */
const hud = document.getElementById('hudScore');
const overlay = document.getElementById('gameOverOverlay');

function handleDeath(){
  if (!gameOver){
    gameOver = true;
    overlay.style.display = 'flex';
  }
}

window.addEventListener('keydown', (e)=>{
  if (e.code === 'Space'){
    if (gameOver){ resetGame(); return; }
    bird.vy = jumpPower;
  }
});
canvas.addEventListener('pointerdown', ()=>{
  if (gameOver){ resetGame(); return; }
  bird.vy = jumpPower;
});
overlay.addEventListener('click', ()=>{ if (gameOver) resetGame(); });

/* NgƒÉn double-tap zoom tr√™n mobile */
let lastTouch = 0;
document.addEventListener('touchend', (e) => {
  let now = Date.now();
  if (now - lastTouch <= 300) e.preventDefault();
  lastTouch = now;
}, {passive:false});

/* =========================
   Menu + draggable toggle
   ========================= */
const toggleBtn = document.getElementById('toggleBtn');
const menuWrap  = document.getElementById('menuWrap');
const closeMenuBtn = document.getElementById('closeMenu');

function openMenu(){
  menuWrap.style.display = 'block';
  menuWrap.setAttribute('aria-hidden','false');
  toggleBtn.style.display = 'none';
}
function closeMenu(){
  menuWrap.style.display = 'none';
  menuWrap.setAttribute('aria-hidden','true');
  toggleBtn.style.display = 'block';
}
closeMenuBtn.addEventListener('click', closeMenu);

/* Ch·ªçn t·ªëc ƒë·ªô */
function setSpeedUI(n){
  speedMultiplier = n;
  document.querySelectorAll('.menu-row .btn').forEach(b=>b.classList.remove('active'));
  const el = document.getElementById('speed'+n);
  if (el) el.classList.add('active');
}
document.getElementById('speed1').addEventListener('click', ()=>setSpeedUI(1));
document.getElementById('speed2').addEventListener('click', ()=>setSpeedUI(2));
document.getElementById('speed3').addEventListener('click', ()=>setSpeedUI(3));
setSpeedUI(1);

/* K√©o/th·∫£ + nh·∫•n m·ªü menu */
let dragging=false, moved=false, offX=0, offY=0;
toggleBtn.addEventListener('pointerdown', (e)=>{
  dragging = true; moved = false;
  toggleBtn.setPointerCapture(e.pointerId);
  offX = e.clientX - toggleBtn.offsetLeft;
  offY = e.clientY - toggleBtn.offsetTop;
  toggleBtn.style.cursor = 'grabbing';
});
window.addEventListener('pointermove', (e)=>{
  if(!dragging) return;
  let nx = e.clientX - offX;
  let ny = e.clientY - offY;
  if (Math.abs(nx - toggleBtn.offsetLeft) > 3 || Math.abs(ny - toggleBtn.offsetTop) > 3) moved = true;
  nx = Math.max(6, Math.min(nx, window.innerWidth  - toggleBtn.offsetWidth  - 6));
  ny = Math.max(6, Math.min(ny, window.innerHeight - toggleBtn.offsetHeight - 6));
  toggleBtn.style.left = nx + 'px';
  toggleBtn.style.top  = ny + 'px';
});
toggleBtn.addEventListener('pointerup', (e)=>{
  dragging = false;
  toggleBtn.style.cursor = 'grab';
  try{ toggleBtn.releasePointerCapture(e.pointerId); }catch(_){}
  if(!moved){ openMenu(); } // tap -> m·ªü menu
});

/* M√®o fallback n·∫øu ·∫£nh l·ªói */
const memeImg = document.getElementById('memeImg');
memeImg.onerror = function(){
  this.style.display = 'none';
  const btn = document.getElementById('toggleBtn');
  btn.textContent = 'üò∫';
  btn.style.fontSize = '30px';
  btn.style.display = 'flex';
  btn.style.alignItems = 'center';
  btn.style.justifyContent = 'center';
};
</script>
</body>
</html>
