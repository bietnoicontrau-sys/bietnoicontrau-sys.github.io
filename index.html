<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<title>Flappy Bird + Bindz Menu</title>
<style>
body {
  margin: 0;
  background: #70c5ce;
  overflow: hidden;
  font-family: Arial, sans-serif;
}
canvas {
  display: block;
  margin: auto;
  background: #70c5ce;
}
#menu {
  position: fixed;
  top: 80px;
  left: 50px;
  width: 250px;
  padding: 15px;
  background: rgba(0,0,0,0.8);
  color: #fff;
  border-radius: 15px;
  border: 4px solid transparent;
  background-clip: padding-box, border-box;
  background-origin: border-box;
  background-image:
    linear-gradient(#000,#000),
    linear-gradient(270deg, red, orange, yellow, green, cyan, blue, violet, red);
  background-size: 300% 300%;
  animation: rainbow 4s linear infinite;
  display: none;
  z-index: 1000;
}
@keyframes rainbow {
  0% { background-position: 0% 50%, 0% 50%; }
  100% { background-position: 300% 50%, 0% 50%; }
}
#menu h3 { margin-top: 0; text-align: center; }
#menu label { display: block; margin-top: 10px; }
#toggleBtn {
  position: fixed;
  top: 20px;
  left: 20px;
  width: 50px;
  height: 50px;
  border-radius: 50%;
  cursor: pointer;
  background: url('https://i.imgur.com/4AiXzf8.jpeg') no-repeat center/cover;
  z-index: 1100;
}
</style>
</head>
<body>
<canvas id="game" width="400" height="600"></canvas>

<div id="menu">
  <h3>üê¶ Bindz Hack üê¶</h3>
  <label>T·ªëc ƒë·ªô bay:
    <select id="speed">
      <option value="1">1</option>
      <option value="2">2</option>
      <option value="3">3</option>
    </select>
  </label>
</div>

<div id="toggleBtn"></div>

<script>
const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");

let frames = 0;
const DEGREE = Math.PI/180;

// Load sprite
const sprite = new Image();
sprite.src = "https://raw.githubusercontent.com/samuelcust/flappy-bird-assets/master/spritesheet.png";

// Game state
const state = { current: 0, getReady: 0, game: 1, over: 2 };

// Control
document.addEventListener("keydown", e => {
  if (e.code === "Space") {
    if (state.current === state.getReady) state.current = state.game;
    else if (state.current === state.game) bird.flap();
    else if (state.current === state.over) resetGame();
  }
});
canvas.addEventListener("click", () => {
  if (state.current === state.getReady) state.current = state.game;
  else if (state.current === state.game) bird.flap();
  else if (state.current === state.over) resetGame();
});

// Bird
const bird = {
  animation: [
    {sX: 276, sY: 112},
    {sX: 276, sY: 139},
    {sX: 276, sY: 164},
    {sX: 276, sY: 139}
  ],
  x: 50, y: 150, w: 34, h: 26,
  frame: 0, gravity: 0.25, jump: 4.6, speed: 0, rotation: 0,
  draw() {
    let bird = this.animation[this.frame];
    ctx.drawImage(sprite, bird.sX, bird.sY, this.w, this.h, this.x, this.y, this.w, this.h);
  },
  flap() { this.speed = -this.jump * hackSpeed; },
  update() {
    // Animation speed
    let period = state.current === state.getReady ? 10 : 5;
    this.frame += frames % period === 0 ? 1 : 0;
    this.frame %= this.animation.length;

    if (state.current === state.getReady) {
      this.y = 150;
      this.rotation = 0 * DEGREE;
    } else {
      this.speed += this.gravity;
      this.y += this.speed;
      if (this.y + this.h/2 >= canvas.height - fg.h) {
        this.y = canvas.height - fg.h - this.h/2;
        if (state.current === state.game) state.current = state.over;
      }
      this.rotation = this.speed >= this.jump ? 90 * DEGREE : -25 * DEGREE;
    }
  }
};

// Foreground
const fg = { sX: 276, sY: 0, w: 224, h: 112, x: 0, y: canvas.height - 112,
  draw() {
    ctx.drawImage(sprite, this.sX, this.sY, this.w, this.h, this.x, this.y, this.w, this.h);
    ctx.drawImage(sprite, this.sX, this.sY, this.w, this.h, this.x + this.w, this.y, this.w, this.h);
  }
};

// Pipes
const pipes = {
  position: [],
  top: { sX: 553, sY: 0 }, bottom: { sX: 502, sY: 0 },
  w: 53, h: 400, gap: 85, maxYPos: -150,
  draw() {
    for (let p of this.position) {
      let topYPos = p.y;
      ctx.drawImage(sprite, this.top.sX, this.top.sY, this.w, this.h, p.x, p.y, this.w, this.h);
      ctx.drawImage(sprite, this.bottom.sX, this.bottom.sY, this.w, this.h, p.x, p.y + this.h + this.gap, this.w, this.h);
    }
  },
  update() {
    if (state.current !== state.game) return;
    if (frames % 100 === 0) {
      this.position.push({
        x: canvas.width,
        y: this.maxYPos * (Math.random() + 1)
      });
    }
    for (let i = 0; i < this.position.length; i++) {
      let p = this.position[i];
      p.x -= 2 * hackSpeed;
      if (p.x + this.w <= 0) this.position.shift();
      // Collision
      if (bird.x + bird.w/2 > p.x && bird.x - bird.w/2 < p.x + this.w &&
         (bird.y - bird.h/2 < p.y + this.h || bird.y + bird.h/2 > p.y + this.h + this.gap)) {
        state.current = state.over;
      }
    }
  },
  reset() { this.position = []; }
};

// Background
const bg = { sX: 0, sY: 0, w: 275, h: 226, x: 0, y: canvas.height - 226,
  draw() {
    ctx.drawImage(sprite, this.sX, this.sY, this.w, this.h, this.x, this.y, this.w, this.h);
    ctx.drawImage(sprite, this.sX, this.sY, this.w, this.h, this.x + this.w, this.y, this.w, this.h);
  }
};

// Hack speed
let hackSpeed = 1;
document.getElementById("speed").addEventListener("change", e => {
  hackSpeed = parseInt(e.target.value);
});

// Toggle menu
const menu = document.getElementById("menu");
const toggleBtn = document.getElementById("toggleBtn");
let menuVisible = false;
toggleBtn.addEventListener("click", () => {
  menuVisible = !menuVisible;
  menu.style.display = menuVisible ? "block" : "none";
});

// Draw
function draw() {
  bg.draw();
  pipes.draw();
  fg.draw();
  bird.draw();
}

// Update
function update() {
  bird.update();
  fg.x = (fg.x - 2) % (fg.w);
  pipes.update();
}

// Loop
function loop() {
  update();
  draw();
  frames++;
  requestAnimationFrame(loop);
}

function resetGame() {
  pipes.reset();
  bird.speed = 0;
  bird.y = 150;
  state.current = state.getReady;
}

loop();
</script>
</body>
</html>
