<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no" />
<title>Flappy Bird - Bindz</title>
<style>
  :root {
    --bg: #70c5ce;
    --menu-grad-1: #ff7a18;
    --menu-grad-2: #af002d;
  }
  html,body{height:100%;margin:0;padding:0;background:var(--bg);font-family:Inter,Arial,sans-serif;overflow:hidden;}
  canvas{display:block;background:linear-gradient(#70c5ce,#5fb3c1);width:100vw;height:100vh;}

/* --- MENU --- */
  #hackMenu {
    position: fixed;
    width: 340px;
    max-width: calc(100% - 40px);
    left: 50%;
    top: 50%;
    transform: translate(-50%,-50%);
    background: linear-gradient(135deg,var(--menu-grad-1),var(--menu-grad-2));
    color: #fff;
    border-radius: 16px;
    padding: 20px;
    box-shadow: 0 12px 30px rgba(0,0,0,0.35);
    backdrop-filter: blur(6px);
    z-index: 1001;
    display: none; /* ·∫©n l√∫c ƒë·∫ßu */
  }
  #hackMenu h1{
    margin:0 0 8px 0;
    font-size:20px;
    text-align:center;
    letter-spacing:1px;
    font-weight:700;
    font-family: "Comic Sans MS", "Segoe UI", Arial;
  }
  #hackMenu .byline{
    text-align:center;
    font-size:12px;
    opacity:0.9;
    margin-bottom:14px;
  }
  .menu-row{display:flex;gap:10px;margin-bottom:12px;}
  .menu-row .btn{
    flex:1;
    padding:12px;
    border-radius:10px;
    border:0;
    cursor:pointer;
    font-weight:700;
    font-size:15px;
    box-shadow: 0 6px 14px rgba(0,0,0,0.25);
  }
  .btn-speed1{background:rgba(255,255,255,0.12);color:#fff;}
  .btn-speed2{background:rgba(255,255,255,0.18);color:#fff;}
  .btn-speed3{background:rgba(255,255,255,0.25);color:#fff;}
  .btn-close{background:#111;color:#fff;padding:10px;border-radius:10px;font-weight:700;width:100%;}
  .menu-note{font-size:13px;opacity:0.95;text-align:center;margin-top:8px;}

/* --- small draggable meme button --- */
  #toggleBtn{
    position: fixed;
    left: 18px;
    top: 18px;
    width:64px;
    height:64px;
    border-radius:50%;
    overflow:hidden;
    border: 3px solid #fff;
    box-shadow: 0 6px 18px rgba(0,0,0,0.35);
    z-index:1002;
    touch-action: none; /* ƒë·ªÉ mobile k√©o m∆∞·ª£t */
    background: #fff;
    cursor: grab;
  }
  #toggleBtn img{width:100%;height:100%;object-fit:cover;display:block;}

/* --- HUD (score) --- */
  #hudScore{
    position: fixed;
    left: 18px;
    bottom: 20px;
    z-index: 1000;
    color: #ffffff;
    text-shadow: 0 2px 6px rgba(0,0,0,0.5);
    font-weight:700;
    font-size:18px;
    background: rgba(0,0,0,0.25);
    padding:8px 12px;border-radius:10px;
    backdrop-filter: blur(4px);
  }
  /* responsive smaller screens */
  @media (max-width:420px){
    #hackMenu{width:92%;}
    #toggleBtn{left:12px;top:12px;width:56px;height:56px;}
  }
</style>
</head>
<body>

<canvas id="gameCanvas"></canvas>

<!-- small draggable meme button (hi·ªán l√∫c b·∫Øt ƒë·∫ßu) -->
<div id="toggleBtn" title="M·ªü Bindz Hack Menu">
  <img id="memeImg" alt="m√®o c∆∞·ªùi" src="https://i.imgur.com/0y8Ftya.png" />
</div>

<!-- menu (·∫©n l√∫c ƒë·∫ßu) -->
<div id="hackMenu" aria-hidden="true">
  <h1>üê¶ Bindz Hack Menu</h1>
  <div class="byline">Bindz ‚Ä¢ Hack nh·∫π cho test</div>

  <div class="menu-row">
    <button class="btn btn-speed1" data-speed="1">Bay x1</button>
    <button class="btn btn-speed2" data-speed="2">Bay x2</button>
    <button class="btn btn-speed3" data-speed="3">Bay x3</button>
  </div>

  <button id="closeMenuBtn" class="btn-close">T·∫Øt Menu</button>
  <div class="menu-note">Ch·∫°m / Space ƒë·ªÉ nh·∫£y ‚Äî ch·ªçn t·ªëc ƒë·ªô ƒë·ªÉ thay ƒë·ªïi ƒë·ªô kh√≥</div>
</div>

<!-- HUD score -->
<div id="hudScore">Score: 0</div>

<script>
/* =========================
   Game core (Flappy-like)
   ========================= */

const canvas = document.getElementById('gameCanvas');
const ctx = canvas.getContext('2d');

function fitCanvas(){
  canvas.width = window.innerWidth;
  canvas.height = window.innerHeight;
}
window.addEventListener('resize', fitCanvas, {passive:true});
fitCanvas();

/* Game state */
let score = 0;
let baseSpeed = 3;       // base pipe speed
let speedMultiplier = 1; // 1..3 selected in menu
let gravity = 0.6;
let jumpPower = -10;

let bird = {
  x: Math.round(canvas.width * 0.18),
  y: canvas.height / 2,
  r: Math.round(Math.min(canvas.width, canvas.height) * 0.035),
  vy: 0
};

let pipes = [];
let spawnInterval = 110; // frames
let frame = 0;
let gameOver = false;

/* spawn pipe */
function spawnPipe(){
  const gapH = Math.round(Math.max(120, canvas.height * 0.22));
  const topH = Math.round(Math.random() * (canvas.height - gapH - 160) + 60);
  pipes.push({
    x: canvas.width + 40,
    w: Math.round(Math.min(90, canvas.width * 0.08)),
    top: topH,
    bottom: topH + gapH
  });
}

/* reset game */
function resetGame(){
  pipes = [];
  frame = 0;
  score = 0;
  document.getElementById('hudScore').textContent = 'Score: 0';
  bird.y = canvas.height / 2;
  bird.vy = 0;
  gameOver = false;
}

/* update */
function update(){
  // bird physics
  bird.vy += gravity;
  bird.y += bird.vy;

  // floor/ceiling
  if (bird.y + bird.r > canvas.height) {
    bird.y = canvas.height - bird.r;
    bird.vy = 0;
    gameOver = true;
  }
  if (bird.y - bird.r < 0) {
    bird.y = bird.r;
    bird.vy = 0;
  }

  // pipes spawn
  if (frame % spawnInterval === 0) spawnPipe();

  const curSpeed = baseSpeed * speedMultiplier;

  // move pipes & collision & scoring
  for (let i = pipes.length - 1; i >= 0; i--) {
    let p = pipes[i];
    p.x -= curSpeed;

    // score when pipe passed
    if (!p.passed && p.x + p.w < bird.x - bird.r) {
      p.passed = true;
      score++;
      document.getElementById('hudScore').textContent = 'Score: ' + score;
    }

    // collision (circle-rect approx)
    const bx = bird.x;
    const by = bird.y;
    const r = bird.r;

    // top rect
    if (rectCircleColliding(p.x, 0, p.w, p.top, bx, by, r) ||
        rectCircleColliding(p.x, p.bottom, p.w, canvas.height - p.bottom, bx, by, r)) {
      gameOver = true;
    }

    // remove off-screen
    if (p.x + p.w < -50) pipes.splice(i,1);
  }

  frame++;
}

/* draw */
function draw(){
  // clear
  ctx.clearRect(0,0,canvas.width,canvas.height);

  // background simple gradient - already from CSS but draw safe
  // draw pipes
  ctx.fillStyle = '#228B22';
  for (let p of pipes){
    ctx.fillRect(p.x, 0, p.w, p.top);
    ctx.fillRect(p.x, p.bottom, p.w, canvas.height - p.bottom);
  }

  // bird
  ctx.save();
  ctx.translate(bird.x, bird.y);
  ctx.beginPath();
  ctx.fillStyle = '#FFD23F';
  ctx.arc(0,0,bird.r,0,Math.PI*2);
  ctx.fill();
  // eye
  ctx.fillStyle = '#000';
  ctx.beginPath();
  ctx.arc(bird.r*0.3, -bird.r*0.15, Math.max(2, bird.r*0.18), 0, Math.PI*2);
  ctx.fill();
  ctx.restore();

  // if game over draw text
  if (gameOver) {
    ctx.fillStyle = 'rgba(0,0,0,0.6)';
    ctx.fillRect(0,0,canvas.width,canvas.height);
    ctx.fillStyle = '#fff';
    ctx.font = `bold ${Math.round(Math.min(canvas.width, canvas.height)*0.06)}px Arial`;
    ctx.textAlign = 'center';
    ctx.fillText('Game Over', canvas.width/2, canvas.height/2 - 20);
    ctx.font = `${Math.round(Math.min(canvas.width, canvas.height)*0.035)}px Arial`;
    ctx.fillText('Nh·∫•n Space ho·∫∑c ch·∫°m ƒë·ªÉ ch∆°i l·∫°i', canvas.width/2, canvas.height/2 + 30);
  }
}

/* main loop */
function loop(){
  update();
  draw();
  requestAnimationFrame(loop);
}
loop();

/* collision helper: rectangle vs circle */
function rectCircleColliding(rx, ry, rw, rh, cx, cy, r) {
  // find closest point on rect to circle center
  let closestX = clamp(cx, rx, rx + rw);
  let closestY = clamp(cy, ry, ry + rh);
  let dx = cx - closestX;
  let dy = cy - closestY;
  return (dx*dx + dy*dy) <= r*r;
}
function clamp(v,a,b){ return Math.max(a, Math.min(b,v)); }

/* input: space or click to flap / restart */
window.addEventListener('keydown', function(e){
  if (e.code === 'Space') {
    if (gameOver) { resetGame(); return; }
    bird.vy = jumpPower;
  }
});
canvas.addEventListener('pointerdown', function(e){
  if (gameOver) { resetGame(); return; }
  bird.vy = jumpPower;
});

/* =========================
   Menu + draggable meme btn
   ========================= */

const toggleBtn = document.getElementById('toggleBtn');
const hackMenu = document.getElementById('hackMenu');
const closeMenuBtn = document.getElementById('closeMenuBtn');

// show menu when clicking meme button
toggleBtn.addEventListener('click', (e)=>{
  e.stopPropagation();
  showMenu(true);
});

// set speeds
document.querySelectorAll('.btn-speed1, .btn-speed2, .btn-speed3').forEach(b=>{
  b.addEventListener('click', ()=>{
    const v = b.getAttribute('data-speed') || b.dataset.speed;
    speedMultiplier = Number(v) || 1;
    // visual feedback: highlight chosen
    document.querySelectorAll('.btn').forEach(btn=>btn.style.opacity = '1');
    b.style.boxShadow = '0 8px 20px rgba(0,0,0,0.35) inset';
  });
});

// close menu -> show small btn
closeMenuBtn.addEventListener('click', ()=>{
  showMenu(false);
});

// initial state: menu hidden, button shown
function showMenu(show){
  if (show) {
    hackMenu.style.display = 'block';
    hackMenu.setAttribute('aria-hidden','false');
    toggleBtn.style.display = 'none';
  } else {
    hackMenu.style.display = 'none';
    hackMenu.setAttribute('aria-hidden','true');
    toggleBtn.style.display = 'block';
  }
}

// make toggleBtn draggable (pointer events)
let dragging = false;
let dragOffset = {x:0,y:0};
toggleBtn.addEventListener('pointerdown', function(e){
  dragging = true;
  toggleBtn.setPointerCapture(e.pointerId);
  dragOffset.x = e.clientX - toggleBtn.offsetLeft;
  dragOffset.y = e.clientY - toggleBtn.offsetTop;
  toggleBtn.style.cursor = 'grabbing';
});
window.addEventListener('pointermove', function(e){
  if (!dragging) return;
  let nx = e.clientX - dragOffset.x;
  let ny = e.clientY - dragOffset.y;
  // clamp within viewport
  nx = clamp(nx, 6, window.innerWidth - toggleBtn.offsetWidth - 6);
  ny = clamp(ny, 6, window.innerHeight - toggleBtn.offsetHeight - 6);
  toggleBtn.style.left = nx + 'px';
  toggleBtn.style.top = ny + 'px';
});
window.addEventListener('pointerup', function(e){
  dragging = false;
  toggleBtn.style.cursor = 'grab';
});

/* small safety: if meme img fails, use emoji */
const memeImg = document.getElementById('memeImg');
memeImg.onerror = function(){
  this.style.display = 'none';
  toggleBtn.textContent = 'üò∫';
  toggleBtn.style.fontSize = '30px';
  toggleBtn.style.display = 'flex';
  toggleBtn.style.alignItems = 'center';
  toggleBtn.style.justifyContent = 'center';
};

/* done: menu & button logic */

/* Prevent double-tap zoom on mobile for canvas region (extra) */
let lastTouch = 0;
document.addEventListener('touchend', (e) => {
  let now = Date.now();
  if (now - lastTouch <= 300) {
    e.preventDefault();
  }
  lastTouch = now;
}, {passive:false});

</script>
</body>
    </html>
